#!/bin/sh
top=$(dirname "$0")
TMP=/tmp/$UID/TemporaryItems
mkdir -p $TMP
cp -f "$top/bin/getdisplay.sh" $TMP
rm -f $TMP/display

open-x11 $TMP/getdisplay.sh || \
open -a XDarwin $TMP/getdisplay.sh || \
echo ":0" > $TMP/display

while [ "$?" == "0" -a ! -f $TMP/display ]; do sleep 1; done
export "DISPLAY=`cat $TMP/display`"

ps -wx -ocommand | grep -e '[X]11' > /dev/null || exit 11

cd ~/

exec "$top/cubism/bin/cubism_vm" "$2"
